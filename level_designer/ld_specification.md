# SM63 Redux level format specification

Version 000

## Terminology
- LD - Level Designer program
- Author - Agent using the LD to create a level
- Player - Agent playing the resulting level
- UniString - Unicode text string with 3 length bytes at the start
- AscString - ASCII text string terminating in asc0 [NULL]

## Structure Overview
- Header
	+ Metadata (generated by LD)
		* Format version
	+ Level info (written by creator)
		* Title
		* Author
		* Mission list
			- Mission 1
				+ Title
				+ Description
			- Mission 2
			- Mission etc.
		* etc.
- Body
	+ Item dictionary
		* Class definition 1
			- Inherit 1
			- Inherit 2
			- Inherit etc.
			- Property 1
				+ ID
				+ Value
			- Property 2
			- Property etc.
		* Class definition 2
		* Class definition etc.
	+ Polygons
		* Material
		* Points
			- Point 1
			- Point 2
			- Point etc.
	+ Pipescript
		* Script dictionary
			- Script definition 1
				+ psl/vpsl flag
				+ Vpsl dump OR minified psl
			- Script definition 2
			- Script definition etc.
		* TODO

## Header

### Metadata
- Format version
	+ 8 bit format version (unlikely that we'll ever exceed 256 versions, but if we somehow do, the format would be so drastically different from version 0 that it would fail anyway and we could handle that)

### Level Info
- Title
	+ UniString
- Description
	+ Unistring
- Author
	+ UniString
- Mission list
	+ Levels can have an arbitrary number of missions
	+ Each mission has a UniString title and description
	+ The list terminates with two U+0000 chars

## Body

### Item Dictionary
- Classes are defined in terms of each other
- Each new class is a reference to another class plus some additional data
- Classes can have a placement flag in order to place them in the level (any missing properties take default value)
- Classes can have multiple placement flags, on the off chance that the author wants two identical items stacked in the same position
- TODO: bit arrangement

### Polygons
- Material
	+ 1 byte
	+ ID that refers to both the polygon's texture set and material properties (e.g. slippery, hot, quicksand, etc.)
- Z Index
	+ 2 bytes, signed
- Vertex count
	+ 4 bytes
- Vertex
	+ 8 bytes
	+ 3 bytes for each coordinate
	+ 24-bit integers
	
### Pipescript
- Script
	+ Script name
		* Ascstring
	+ Script content
		* Ascstring